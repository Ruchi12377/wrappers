{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"supabase/wrappers Documentation : https://supabase.github.io/wrappers Source Code : https://github.com/supabase/wrappers Overview supabase/wrappers is a PostgreSQL extension that provides integrations with external sources so you can interact with third-party data using SQL. For example, the Stripe wrapper allows you to query and join against your Stripe customer data straight from PostgreSQL: 1 2 3 4 5 select customer_id currency from stripe . customers ; returns 1 2 3 4 customer_id | currency --------------------+----------- cus_MJiBtCqOF1Bb3F | usd (1 row) Currently supabase/wrappers supports: Integration Select Insert Update Delete Truncate BigQuery Firebase S3 Stripe","title":"Welcome"},{"location":"#supabasewrappers","text":"Documentation : https://supabase.github.io/wrappers Source Code : https://github.com/supabase/wrappers","title":"supabase/wrappers"},{"location":"#overview","text":"supabase/wrappers is a PostgreSQL extension that provides integrations with external sources so you can interact with third-party data using SQL. For example, the Stripe wrapper allows you to query and join against your Stripe customer data straight from PostgreSQL: 1 2 3 4 5 select customer_id currency from stripe . customers ; returns 1 2 3 4 customer_id | currency --------------------+----------- cus_MJiBtCqOF1Bb3F | usd (1 row) Currently supabase/wrappers supports: Integration Select Insert Update Delete Truncate BigQuery Firebase S3 Stripe","title":"Overview"},{"location":"bigquery/","text":"BigQuery is a completely serverless and cost-effective enterprise data warehouse that works across clouds and scales with your data, with BI, machine learning and AI built in. BigQuery FDW supports both data read and modify. Wrapper To get started with the BigQuery wrapper, create a foreign data wrapper specifying handler and validator as below. 1 2 3 4 5 create extension if not exists wrappers ; create foreign data wrapper bigquery_wrapper handler bigquery_fdw_handler validator bigquery_fdw_validator ; Server Next, we need to create a server for the FDW to hold options and credentials. Auth (Supabase) If you are using the Supabase platform, this is the recommended approach for securing your GCP credentials. For example, to store GCP credential JSON in Vault and retrieve the key_id , 1 2 3 4 5 6 7 8 9 10 11 12 13 -- save BigQuery service account json in Vault and get its key id select pgsodium . create_key ( name : = 'bigquery' ); insert into vault . secrets ( secret , key_id ) values ( ' { \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", \"private_key_id\": \"your_private_key_id\", \"private_key\": \"-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\\n\", ... } ' , ( select id from pgsodium . valid_key where name = 'bigquery' ) ) returning key_id ; Then create the foreign server, 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 do $$ declare key_id text ; begin select id into key_id from pgsodium . valid_key where name = 'bigquery' limit 1 ; execute format ( E 'create server bigquery_server \\n' ' foreign data wrapper bigquery_wrapper \\n' ' options ( \\n' ' sa_key_id ''%s'', \\n' ' project_id ''your_gcp_project_id'', \\n' ' dataset_id ''your_gcp_dataset_id'' \\n' ' );' , key_id ); end $$ ; Auth (Non-Supabase) If the platform you are using does not support pgsodium and Vault , you can create a server by storing yourt GCP credentials directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 6 7 8 9 10 11 12 13 create server bigquery_server foreign data wrapper bigquery_wrapper options ( sa_key ' { \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... } ' , project_id 'your_gcp_project_id' , dataset_id 'your_gcp_dataset_id' ); Tables BigQuery wrapper is implemented with ELT approach, so the data transformation is encouraged to be performed locally after data is extracted from remote data source. Foreign Table Options The full list of foreign table options are below: table - Source table or view name in BigQuery, required. This can also be a subquery enclosed in parentheses, for example, 1 table '(select * except(props), to_json_string(props) as props from `my_project.my_dataset.my_table`)' location - Source table location, optional. Default is 'US'. rowid_column - Primary key column name, optional for data scan, required for data modify Examples Create a source table on BigQuery and insert some data, 1 2 3 4 5 6 7 8 9 10 create table your_project_id . your_dataset_id . people ( id int64 , name string , ts timestamp ); insert into your_project_id . your_dataset_id . people values ( 1 , 'Luke Skywalker' , current_timestamp ()), ( 2 , 'Leia Organa' , current_timestamp ()), ( 3 , 'Han Solo' , current_timestamp ()); Create foreign table and run a query on Postgres to read BigQuery table, 1 2 3 4 5 6 7 8 9 10 11 12 create foreign table people ( id bigint , name text , ts timestamp ) server bigquery_server options ( table 'people' , location 'EU' ); select * from people ;","title":"BigQuery"},{"location":"bigquery/#wrapper","text":"To get started with the BigQuery wrapper, create a foreign data wrapper specifying handler and validator as below. 1 2 3 4 5 create extension if not exists wrappers ; create foreign data wrapper bigquery_wrapper handler bigquery_fdw_handler validator bigquery_fdw_validator ;","title":"Wrapper"},{"location":"bigquery/#server","text":"Next, we need to create a server for the FDW to hold options and credentials.","title":"Server"},{"location":"bigquery/#auth-supabase","text":"If you are using the Supabase platform, this is the recommended approach for securing your GCP credentials. For example, to store GCP credential JSON in Vault and retrieve the key_id , 1 2 3 4 5 6 7 8 9 10 11 12 13 -- save BigQuery service account json in Vault and get its key id select pgsodium . create_key ( name : = 'bigquery' ); insert into vault . secrets ( secret , key_id ) values ( ' { \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", \"private_key_id\": \"your_private_key_id\", \"private_key\": \"-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\\n\", ... } ' , ( select id from pgsodium . valid_key where name = 'bigquery' ) ) returning key_id ; Then create the foreign server, 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 do $$ declare key_id text ; begin select id into key_id from pgsodium . valid_key where name = 'bigquery' limit 1 ; execute format ( E 'create server bigquery_server \\n' ' foreign data wrapper bigquery_wrapper \\n' ' options ( \\n' ' sa_key_id ''%s'', \\n' ' project_id ''your_gcp_project_id'', \\n' ' dataset_id ''your_gcp_dataset_id'' \\n' ' );' , key_id ); end $$ ;","title":"Auth (Supabase)"},{"location":"bigquery/#auth-non-supabase","text":"If the platform you are using does not support pgsodium and Vault , you can create a server by storing yourt GCP credentials directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 6 7 8 9 10 11 12 13 create server bigquery_server foreign data wrapper bigquery_wrapper options ( sa_key ' { \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... } ' , project_id 'your_gcp_project_id' , dataset_id 'your_gcp_dataset_id' );","title":"Auth (Non-Supabase)"},{"location":"bigquery/#tables","text":"BigQuery wrapper is implemented with ELT approach, so the data transformation is encouraged to be performed locally after data is extracted from remote data source.","title":"Tables"},{"location":"bigquery/#foreign-table-options","text":"The full list of foreign table options are below: table - Source table or view name in BigQuery, required. This can also be a subquery enclosed in parentheses, for example, 1 table '(select * except(props), to_json_string(props) as props from `my_project.my_dataset.my_table`)' location - Source table location, optional. Default is 'US'. rowid_column - Primary key column name, optional for data scan, required for data modify","title":"Foreign Table Options"},{"location":"bigquery/#examples","text":"Create a source table on BigQuery and insert some data, 1 2 3 4 5 6 7 8 9 10 create table your_project_id . your_dataset_id . people ( id int64 , name string , ts timestamp ); insert into your_project_id . your_dataset_id . people values ( 1 , 'Luke Skywalker' , current_timestamp ()), ( 2 , 'Leia Organa' , current_timestamp ()), ( 3 , 'Han Solo' , current_timestamp ()); Create foreign table and run a query on Postgres to read BigQuery table, 1 2 3 4 5 6 7 8 9 10 11 12 create foreign table people ( id bigint , name text , ts timestamp ) server bigquery_server options ( table 'people' , location 'EU' ); select * from people ;","title":"Examples"},{"location":"contributing/","text":"supabase/wrappers is OSS. PRs and issues are welcome. Development Requirements: rust cargo docker-compose pgx Testing Tests are located in ./test/sql with expected output in ./test/expected To run tests locally, execute: 1 2 cd wrappers docker-compose -f .ci/docker-compose.yaml run test-wrappers Interactive PSQL Development To reduce the iteration cycle, you may want to launch a psql prompt with wrappers installed to experiment 1 2 cd wrappers cargo pgx run pg14 --features clickhouse_fdw Try out the commands below to spin up a database with the extension installed & query a table using GraphQL. Experiment with aliasing field/table names and filtering on different columns. 1 2 > create extension wrappers cascade ; CREATE EXTENSION Documentation All public API must be documented. Building documentation requires python 3.6+ Install Dependencies Install mkdocs, themes, and extensions. 1 pip install -r docs/requirements_docs.txt Serving To serve the documentation locally run 1 mkdocs serve and visit the docs at http://127.0.0.1:8000/wrappers/ Deploying If you have write access to the repo, docs can be updated using 1 mkdocs gh-deploy","title":"Contributing"},{"location":"contributing/#development","text":"Requirements: rust cargo docker-compose pgx","title":"Development"},{"location":"contributing/#testing","text":"Tests are located in ./test/sql with expected output in ./test/expected To run tests locally, execute: 1 2 cd wrappers docker-compose -f .ci/docker-compose.yaml run test-wrappers","title":"Testing"},{"location":"contributing/#interactive-psql-development","text":"To reduce the iteration cycle, you may want to launch a psql prompt with wrappers installed to experiment 1 2 cd wrappers cargo pgx run pg14 --features clickhouse_fdw Try out the commands below to spin up a database with the extension installed & query a table using GraphQL. Experiment with aliasing field/table names and filtering on different columns. 1 2 > create extension wrappers cascade ; CREATE EXTENSION","title":"Interactive PSQL Development"},{"location":"contributing/#documentation","text":"All public API must be documented. Building documentation requires python 3.6+","title":"Documentation"},{"location":"contributing/#install-dependencies","text":"Install mkdocs, themes, and extensions. 1 pip install -r docs/requirements_docs.txt","title":"Install Dependencies"},{"location":"contributing/#serving","text":"To serve the documentation locally run 1 mkdocs serve and visit the docs at http://127.0.0.1:8000/wrappers/","title":"Serving"},{"location":"contributing/#deploying","text":"If you have write access to the repo, docs can be updated using 1 mkdocs gh-deploy","title":"Deploying"},{"location":"firebase/","text":"Firebase is an app development platform built around non-relational technologies. The Firebase wrapper supports connecting to below objects. Authentication Users ( read only ) Firestore Database Documents ( read only ) Wrapper To get started with the Firebase wrapper, create a foreign data wrapper specifying handler and validator as below. 1 2 3 4 5 create extension if not exists wrappers ; create foreign data wrapper firebase_wrapper handler firebase_fdw_handler validator firebase_fdw_validator ; Server Next, we need to create a server for the FDW to hold options and credentials. Auth (Supabase) If you are using the Supabase platform, this is the recommended approach for securing your Firebase service account credentials. Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'firebase' ); Save your Firebase service account key in Vault and retrieve the key_id 1 2 3 4 5 6 7 8 9 10 11 12 13 insert into vault . secrets ( secret , key_id ) values ( '{ \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... }' , ( select id from pgsodium . valid_key where name = 'firebase' ) ); returning key_id ; Create the foreign server 1 2 3 4 5 6 create server firebase_server foreign data wrapper firebase_wrapper options ( sa_key_id '<your key_id from above>' project_id '<firebase_project_id>' ); Auth (Insecure) If the platform you are using does not support pgsodium and Vault , you can create a server by storing yourt service account key directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 6 7 8 9 10 11 12 create server firebase_server foreign data wrapper firebase_wrapper options ( sa_key ' { \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... } ' , project_id 'firebase_project_id' , ); Tables Firebase collections are non-relational/documents. With the exception of metadata fields, all returned data are availble as a attrs jsonb column. Firestore To map a Firestore collection provide its location using the format firestore/<collection_id> as the object option as shown below. 1 2 3 4 5 6 7 8 9 10 create foreign table firebase_docs ( name text , created_at timestamp , updated_at timestamp , attrs jsonb ) server firebase_server options ( object 'firestore/user-profiles' -- format: 'firestore/[collection_id]' ); Note that name , created_at , and updated_at , are automatic metadata fields on all Firestore collections. auth/users The auth/users collection is a special case with unique metadata. The following shows how to map Firebase users to PostgreSQL table. 1 2 3 4 5 6 7 8 9 10 create foreign table firebase_users ( uid text , email text , created_at timestamp , attrs jsonb ) server firebase_server options ( object 'auth/users' );","title":"Firebase"},{"location":"firebase/#wrapper","text":"To get started with the Firebase wrapper, create a foreign data wrapper specifying handler and validator as below. 1 2 3 4 5 create extension if not exists wrappers ; create foreign data wrapper firebase_wrapper handler firebase_fdw_handler validator firebase_fdw_validator ;","title":"Wrapper"},{"location":"firebase/#server","text":"Next, we need to create a server for the FDW to hold options and credentials.","title":"Server"},{"location":"firebase/#auth-supabase","text":"If you are using the Supabase platform, this is the recommended approach for securing your Firebase service account credentials. Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'firebase' ); Save your Firebase service account key in Vault and retrieve the key_id 1 2 3 4 5 6 7 8 9 10 11 12 13 insert into vault . secrets ( secret , key_id ) values ( '{ \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... }' , ( select id from pgsodium . valid_key where name = 'firebase' ) ); returning key_id ; Create the foreign server 1 2 3 4 5 6 create server firebase_server foreign data wrapper firebase_wrapper options ( sa_key_id '<your key_id from above>' project_id '<firebase_project_id>' );","title":"Auth (Supabase)"},{"location":"firebase/#auth-insecure","text":"If the platform you are using does not support pgsodium and Vault , you can create a server by storing yourt service account key directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 6 7 8 9 10 11 12 create server firebase_server foreign data wrapper firebase_wrapper options ( sa_key ' { \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... } ' , project_id 'firebase_project_id' , );","title":"Auth (Insecure)"},{"location":"firebase/#tables","text":"Firebase collections are non-relational/documents. With the exception of metadata fields, all returned data are availble as a attrs jsonb column.","title":"Tables"},{"location":"firebase/#firestore","text":"To map a Firestore collection provide its location using the format firestore/<collection_id> as the object option as shown below. 1 2 3 4 5 6 7 8 9 10 create foreign table firebase_docs ( name text , created_at timestamp , updated_at timestamp , attrs jsonb ) server firebase_server options ( object 'firestore/user-profiles' -- format: 'firestore/[collection_id]' ); Note that name , created_at , and updated_at , are automatic metadata fields on all Firestore collections.","title":"Firestore"},{"location":"firebase/#authusers","text":"The auth/users collection is a special case with unique metadata. The following shows how to map Firebase users to PostgreSQL table. 1 2 3 4 5 6 7 8 9 10 create foreign table firebase_users ( uid text , email text , created_at timestamp , attrs jsonb ) server firebase_server options ( object 'auth/users' );","title":"auth/users"},{"location":"installation/","text":"First, install pgx Then clone the repo and install using 1 2 3 git clone https://github.com/supabase/wrappers.git cd wrappers/wrappers cargo pgx install --no-default-features --features pg14,<some_integration>_fdw --release To enable the extension in PostgreSQL we must execute a create extension statement. 1 create extension wrappers ;","title":"Installation"},{"location":"s3/","text":"AWS S3 is an object storage service offering industry-leading scalability, data availability, security, and performance. The S3 wrapper is under development. It is read-only and supports 2 file formats: CSV - with or without header line JSON Lines The S3 FDW also supports below compression algorithms: gzip bzip2 xz zlib Note: currently all columns in S3 files must be defined in the foreign table and their types must be text type Wrapper To get started with the S3 wrapper, create a foreign data wrapper specifying handler and validator as below. 1 2 3 4 5 create extension if not exists wrappers ; create foreign data wrapper s3_wrapper handler s3_fdw_handler validator s3_fdw_validator ; Server Next, we need to create a server for the FDW to hold options and credentials. Auth (Supabase) If you are using the Supabase platform, this is the recommended approach for securing your AWS credentials. For example, to store AWS access key id to vault_access_key_id in Vault: Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'vault_access_key_id' ); Save your credential in Vault and retrieve the key_id 1 2 3 4 5 6 7 8 9 insert into vault . secrets ( secret , key_id ) values ( 'AKIAXXXXXX' , ( select id from pgsodium . valid_key where name = 'vault_access_key_id' ) ); returning key_id ; You can follow the same steps to store vault_secret_access_key in Vault. Then create the foreign server 1 2 3 4 5 6 7 create server s3_server foreign data wrapper s3_wrapper options ( vault_access_key_id '<your vault_access_key_id from above>' , vault_secret_access_key '<your vault_secret_access_key_id from above>' , aws_region 'us-east-1' ); Auth (Non-Supabase) If the platform you are using does not support pgsodium and Vault , you can create a server by storing yourt AWS credentials directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 6 7 create server s3_server foreign data wrapper s3_wrapper options ( aws_access_key_id 'your_aws_access_key_id' , aws_secret_access_key 'your_aws_secret_access_key' , aws_region 'us-east-1' ); Tables S3 wrapper is implemented with ELT approach, so the data transformation is encouraged to be performed locally after data is extracted from remote data source. One file in S3 corresponds a foreign table in Postgres, all columns must be present in the foreign table and type must be text . You can do custom transformations, like type conversion, by creating a view on top of the foreign table or using a subquery. Foreign Table Options The full list of foreign table options are below: uri - S3 URI, required. For example, s3://bucket/s3_table.csv format - File format, required. csv or jsonl has_header - If the CSV file has header, optional. true or false , default is false compress - Compression algorithm, optional. One of gzip , bzip2 , xz , zlib , default is no compression Examples 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 -- CSV file, no compression create foreign table s3_table_csv ( name text , sex text , age text , height text , weight text ) server s3_server options ( uri 's3://bucket/s3_table.csv' , format 'csv' , has_header 'true' ); -- JSON line file, no compression create foreign table s3_table_jsonl ( name text , sex text , age text , height text , weight text ) server s3_server options ( uri 's3://bucket/s3_table.jsonl' , format 'jsonl' ); -- GZIP compressed CSV file create foreign table s3_table_csv_gzip ( name text , sex text , age text , height text , weight text ) server s3_server options ( uri 's3://bucket/s3_table.csv.gz' , format 'csv' , has_header 'true' , compress 'gzip' );","title":"S3"},{"location":"s3/#wrapper","text":"To get started with the S3 wrapper, create a foreign data wrapper specifying handler and validator as below. 1 2 3 4 5 create extension if not exists wrappers ; create foreign data wrapper s3_wrapper handler s3_fdw_handler validator s3_fdw_validator ;","title":"Wrapper"},{"location":"s3/#server","text":"Next, we need to create a server for the FDW to hold options and credentials.","title":"Server"},{"location":"s3/#auth-supabase","text":"If you are using the Supabase platform, this is the recommended approach for securing your AWS credentials. For example, to store AWS access key id to vault_access_key_id in Vault: Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'vault_access_key_id' ); Save your credential in Vault and retrieve the key_id 1 2 3 4 5 6 7 8 9 insert into vault . secrets ( secret , key_id ) values ( 'AKIAXXXXXX' , ( select id from pgsodium . valid_key where name = 'vault_access_key_id' ) ); returning key_id ; You can follow the same steps to store vault_secret_access_key in Vault. Then create the foreign server 1 2 3 4 5 6 7 create server s3_server foreign data wrapper s3_wrapper options ( vault_access_key_id '<your vault_access_key_id from above>' , vault_secret_access_key '<your vault_secret_access_key_id from above>' , aws_region 'us-east-1' );","title":"Auth (Supabase)"},{"location":"s3/#auth-non-supabase","text":"If the platform you are using does not support pgsodium and Vault , you can create a server by storing yourt AWS credentials directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 6 7 create server s3_server foreign data wrapper s3_wrapper options ( aws_access_key_id 'your_aws_access_key_id' , aws_secret_access_key 'your_aws_secret_access_key' , aws_region 'us-east-1' );","title":"Auth (Non-Supabase)"},{"location":"s3/#tables","text":"S3 wrapper is implemented with ELT approach, so the data transformation is encouraged to be performed locally after data is extracted from remote data source. One file in S3 corresponds a foreign table in Postgres, all columns must be present in the foreign table and type must be text . You can do custom transformations, like type conversion, by creating a view on top of the foreign table or using a subquery.","title":"Tables"},{"location":"s3/#foreign-table-options","text":"The full list of foreign table options are below: uri - S3 URI, required. For example, s3://bucket/s3_table.csv format - File format, required. csv or jsonl has_header - If the CSV file has header, optional. true or false , default is false compress - Compression algorithm, optional. One of gzip , bzip2 , xz , zlib , default is no compression","title":"Foreign Table Options"},{"location":"s3/#examples","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 -- CSV file, no compression create foreign table s3_table_csv ( name text , sex text , age text , height text , weight text ) server s3_server options ( uri 's3://bucket/s3_table.csv' , format 'csv' , has_header 'true' ); -- JSON line file, no compression create foreign table s3_table_jsonl ( name text , sex text , age text , height text , weight text ) server s3_server options ( uri 's3://bucket/s3_table.jsonl' , format 'jsonl' ); -- GZIP compressed CSV file create foreign table s3_table_csv_gzip ( name text , sex text , age text , height text , weight text ) server s3_server options ( uri 's3://bucket/s3_table.csv.gz' , format 'csv' , has_header 'true' , compress 'gzip' );","title":"Examples"},{"location":"stripe/","text":"Stripe is an API driven online payment processing utilty. supabase/wrappers exposes below endpoints. Accounts ( read only ) Balance ( read only ) Balance Transactions ( read only ) Charges ( read only ) Customers ( read and modify ) Disputes ( read only ) Events ( read only ) Files ( read only ) File Links ( read only ) Invoices ( read only ) Mandates ( read only ) PaymentIntents ( read only ) Payouts ( read only ) Products ( read and modify ) Refunds ( read only ) SetupAttempts ( read only ) SetupIntents ( read only ) Subscriptions ( read and modify ) Tokens ( read only ) Topups ( read only ) Transfers ( read only ) Wrapper To get started with the Stripe wrapper, create a foreign data wrapper specifying handler and validator as below. 1 2 3 4 5 create extension if not exists wrappers ; create foreign data wrapper stripe_wrapper handler stripe_fdw_handler validator stripe_fdw_validator ; Server Next, we need to create a server for the FDW to hold options and credentials. Auth (Supabase) If you are using the Supabase platform, this is the recommended approach for securing your Stripe API key . Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'stripe' ); Save your Stripe API key in Vault and retrieve the key_id 1 2 3 4 5 6 7 insert into vault . secrets ( secret , key_id ) values ( 'sk_test_xxx' , ( select id from pgsodium . valid_key where name = 'stripe' ) ) returning key_id ; Create the foreign server 1 2 3 4 5 create server stripe_server foreign data wrapper stripe_wrapper options ( api_key_id '<your key_id from above>' ); Auth (Insecure) If the platform you are using does not support pgsodium and Vault you can create a server by storing your Stripe API key directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 create server stripe_server foreign data wrapper stripe_wrapper options ( api_key 'sk_test_xxx' ); Tables The Stripe tables mirror Stripe's API. (Optional) Create a schema to hold the Stripe tables. 1 create schema stripe ; Accounts read only This is an object representing a Stripe account. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . accounts ( id text , business_type text , country text , email text , type text , created timestamp , attrs jsonb ) server stripe_server options ( object 'accounts' ); While any column is allowed in a where clause, it is most efficient to filter by: id Balance read only Shows the balance currently on your Stripe account. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 create foreign table stripe . balance ( balance_type text , amount bigint , currency text , attrs jsonb ) server stripe_server options ( object 'balance' ); Balance Transactions read only Balance transactions represent funds moving through your Stripe account. They're created for every type of transaction that comes into or flows out of your Stripe account balance. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 create foreign table stripe . balance_transactions ( id text , amount bigint , currency text , description text , fee bigint , net bigint , status text , type text , created timestamp , attrs jsonb ) server stripe_server options ( object 'balance_transactions' ); While any column is allowed in a where clause, it is most efficient to filter by: id type Charges read only To charge a credit or a debit card, you create a Charge object. You can retrieve and refund individual charges as well as list all charges. Charges are identified by a unique, random ID. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 create foreign table stripe . charges ( id text , amount bigint , currency text , customer text , description text , invoice text , payment_intent text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'charges' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer Customers read and modify Contains customers known to Stripe. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . customers ( id text , email text , name text , description text , created timestamp , attrs jsonb ) server stripe_server options ( object 'customers' , rowid_column 'id' ); While any column is allowed in a where clause, it is most efficient to filter by: id email Disputes read only A dispute occurs when a customer questions your charge with their card issuer. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . disputes ( id text , amount bigint , currency text , charge text , payment_intent text , reason text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'disputes' ); While any column is allowed in a where clause, it is most efficient to filter by: id charge payment_intent Events read only Events are our way of letting you know when something interesting happens in your account. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 create foreign table stripe . events ( id text , type text , api_version text , created timestamp , attrs jsonb ) server stripe_server options ( object 'events' ); While any column is allowed in a where clause, it is most efficient to filter by: id type Files read only This is an object representing a file hosted on Stripe's servers. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 create foreign table stripe . files ( id text , filename text , purpose text , title text , size bigint , type text , url text , created timestamp , expires_at timestamp , attrs jsonb ) server stripe_server options ( object 'files' ); While any column is allowed in a where clause, it is most efficient to filter by: id purpose File Links read only To share the contents of a File object with non-Stripe users, you can create a FileLink . Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . file_links ( id text , file text , url text , created timestamp , expired bool , expires_at timestamp , attrs jsonb ) server stripe_server options ( object 'file_links' ); Invoices read only Invoices are statements of amounts owed by a customer, and are either generated one-off, or generated periodically from a subscription. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . invoices ( id text , customer text , subscription text , status text , total bigint , currency text , period_start timestamp , period_end timestamp , attrs jsonb ) server stripe_server options ( object 'invoices' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer status subscription Mandates read only A Mandate is a record of the permission a customer has given you to debit their payment method. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 create foreign table stripe . mandates ( id text , payment_method text , status text , type text , attrs jsonb ) server stripe_server options ( object 'mandates' ); While any column is allowed in a where clause, it is most efficient to filter by: id Payment Intents read only A payment intent guides you through the process of collecting a payment from your customer. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . payment_intents ( id text , customer text , amount bigint , currency text , payment_method text , created timestamp , attrs jsonb ) server stripe_server options ( object 'payment_intents' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer Payouts read only A Payout object is created when you receive funds from Stripe, or when you initiate a payout to either a bank account or debit card of a connected Stripe account. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . payouts ( id text , amount bigint , currency text , arrival_date timestamp , description text , statement_descriptor text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'payouts' ); While any column is allowed in a where clause, it is most efficient to filter by: id status Products read and modify All products available in Stripe. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . products ( id text , name text , active bool , default_price text , description text , created timestamp , updated timestamp , attrs jsonb ) server stripe_server options ( object 'products' , rowid_column 'id' ); While any column is allowed in a where clause, it is most efficient to filter by: id active Refunds read only Refund objects allow you to refund a charge that has previously been created but not yet refunded. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . refunds ( id text , amount bigint , currency text , charge text , payment_intent text , reason text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'refunds' ); While any column is allowed in a where clause, it is most efficient to filter by: id charge payment_intent SetupAttempts read only A SetupAttempt describes one attempted confirmation of a SetupIntent, whether that confirmation was successful or unsuccessful. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 create foreign table stripe . setup_attempts ( id text , application text , customer text , on_behalf_of text , payment_method text , setup_intent text , status text , usage text , created timestamp , attrs jsonb ) server stripe_server options ( object 'setup_attempts' ); While any column is allowed in a where clause, it is most efficient to filter by: id setup_intent SetupIntents read only A SetupIntent guides you through the process of setting up and saving a customer's payment credentials for future payments. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . setup_intents ( id text , client_secret text , customer text , description text , payment_method text , status text , usage text , created timestamp , attrs jsonb ) server stripe_server options ( object 'setup_intents' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer payment_method Subscriptions read and modify Customer recurring payment schedules. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . subscriptions ( id text , customer text , currency text , current_period_start timestamp , current_period_end timestamp , attrs jsonb ) server stripe_server options ( object 'subscriptions' , rowid_column 'id' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer price status Tokens read only Tokenization is the process Stripe uses to collect sensitive card or bank account details, or personally identifiable information (PII), directly from your customers in a secure manner. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 create foreign table stripe . tokens ( id text , customer text , currency text , current_period_start timestamp , current_period_end timestamp , attrs jsonb ) server stripe_server options ( object 'tokens' ); Top-ups read only To top up your Stripe balance, you create a top-up object. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . topups ( id text , amount bigint , currency text , description text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'topups' ); While any column is allowed in a where clause, it is most efficient to filter by: id status Transfers read only A Transfer object is created when you move funds between Stripe accounts as part of Connect. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . transfers ( id text , amount bigint , currency text , description text , destination text , created timestamp , attrs jsonb ) server stripe_server options ( object 'transfers' ); While any column is allowed in a where clause, it is most efficient to filter by: id destination Examples Some examples on how to use Stripe foreign tables. Simple Query 1 2 3 4 -- always limit records to reduce API calls to Stripe select * from stripe . customers limit 10 ; select * from stripe . invoices limit 10 ; select * from stripe . subscriptions limit 10 ; Query JSON Attributes attrs is a common column which stores all the object attributes in JSON format, you can extract any attributes needed or its associated sub objects from it. For example, 1 2 3 4 5 6 7 8 9 10 11 -- extract account name for an invoice select id , attrs ->> 'account_name' as account_name from stripe . invoices where id = 'in_xxx' ; -- extract invoice line items for an invoice select id , attrs #> '{lines,data}' as line_items from stripe . invoices where id = 'in_xxx' ; -- extract subscription items for a subscription select id , attrs #> '{items,data}' as items from stripe . subscriptions where id = 'sub_xxx' ; Data Modify 1 2 3 4 insert into stripe . customers ( email , name , description ) values ( 'test@test.com' , 'test name' , null ); update stripe . customers set description = 'hello fdw' where id = 'cus_xxx' ; update stripe . customers set attrs = '{\"metadata[foo]\": \"bar\"}' where id = 'cus_xxx' ; delete from stripe . customers where id = 'cus_xxx' ;","title":"Stripe"},{"location":"stripe/#wrapper","text":"To get started with the Stripe wrapper, create a foreign data wrapper specifying handler and validator as below. 1 2 3 4 5 create extension if not exists wrappers ; create foreign data wrapper stripe_wrapper handler stripe_fdw_handler validator stripe_fdw_validator ;","title":"Wrapper"},{"location":"stripe/#server","text":"Next, we need to create a server for the FDW to hold options and credentials.","title":"Server"},{"location":"stripe/#auth-supabase","text":"If you are using the Supabase platform, this is the recommended approach for securing your Stripe API key . Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'stripe' ); Save your Stripe API key in Vault and retrieve the key_id 1 2 3 4 5 6 7 insert into vault . secrets ( secret , key_id ) values ( 'sk_test_xxx' , ( select id from pgsodium . valid_key where name = 'stripe' ) ) returning key_id ; Create the foreign server 1 2 3 4 5 create server stripe_server foreign data wrapper stripe_wrapper options ( api_key_id '<your key_id from above>' );","title":"Auth (Supabase)"},{"location":"stripe/#auth-insecure","text":"If the platform you are using does not support pgsodium and Vault you can create a server by storing your Stripe API key directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 create server stripe_server foreign data wrapper stripe_wrapper options ( api_key 'sk_test_xxx' );","title":"Auth (Insecure)"},{"location":"stripe/#tables","text":"The Stripe tables mirror Stripe's API. (Optional) Create a schema to hold the Stripe tables. 1 create schema stripe ;","title":"Tables"},{"location":"stripe/#accounts","text":"read only This is an object representing a Stripe account. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . accounts ( id text , business_type text , country text , email text , type text , created timestamp , attrs jsonb ) server stripe_server options ( object 'accounts' ); While any column is allowed in a where clause, it is most efficient to filter by: id","title":"Accounts"},{"location":"stripe/#balance","text":"read only Shows the balance currently on your Stripe account. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 create foreign table stripe . balance ( balance_type text , amount bigint , currency text , attrs jsonb ) server stripe_server options ( object 'balance' );","title":"Balance"},{"location":"stripe/#balance-transactions","text":"read only Balance transactions represent funds moving through your Stripe account. They're created for every type of transaction that comes into or flows out of your Stripe account balance. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 create foreign table stripe . balance_transactions ( id text , amount bigint , currency text , description text , fee bigint , net bigint , status text , type text , created timestamp , attrs jsonb ) server stripe_server options ( object 'balance_transactions' ); While any column is allowed in a where clause, it is most efficient to filter by: id type","title":"Balance Transactions"},{"location":"stripe/#charges","text":"read only To charge a credit or a debit card, you create a Charge object. You can retrieve and refund individual charges as well as list all charges. Charges are identified by a unique, random ID. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 create foreign table stripe . charges ( id text , amount bigint , currency text , customer text , description text , invoice text , payment_intent text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'charges' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer","title":"Charges"},{"location":"stripe/#customers","text":"read and modify Contains customers known to Stripe. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . customers ( id text , email text , name text , description text , created timestamp , attrs jsonb ) server stripe_server options ( object 'customers' , rowid_column 'id' ); While any column is allowed in a where clause, it is most efficient to filter by: id email","title":"Customers"},{"location":"stripe/#disputes","text":"read only A dispute occurs when a customer questions your charge with their card issuer. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . disputes ( id text , amount bigint , currency text , charge text , payment_intent text , reason text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'disputes' ); While any column is allowed in a where clause, it is most efficient to filter by: id charge payment_intent","title":"Disputes"},{"location":"stripe/#events","text":"read only Events are our way of letting you know when something interesting happens in your account. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 create foreign table stripe . events ( id text , type text , api_version text , created timestamp , attrs jsonb ) server stripe_server options ( object 'events' ); While any column is allowed in a where clause, it is most efficient to filter by: id type","title":"Events"},{"location":"stripe/#files","text":"read only This is an object representing a file hosted on Stripe's servers. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 create foreign table stripe . files ( id text , filename text , purpose text , title text , size bigint , type text , url text , created timestamp , expires_at timestamp , attrs jsonb ) server stripe_server options ( object 'files' ); While any column is allowed in a where clause, it is most efficient to filter by: id purpose","title":"Files"},{"location":"stripe/#file-links","text":"read only To share the contents of a File object with non-Stripe users, you can create a FileLink . Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . file_links ( id text , file text , url text , created timestamp , expired bool , expires_at timestamp , attrs jsonb ) server stripe_server options ( object 'file_links' );","title":"File Links"},{"location":"stripe/#invoices","text":"read only Invoices are statements of amounts owed by a customer, and are either generated one-off, or generated periodically from a subscription. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . invoices ( id text , customer text , subscription text , status text , total bigint , currency text , period_start timestamp , period_end timestamp , attrs jsonb ) server stripe_server options ( object 'invoices' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer status subscription","title":"Invoices"},{"location":"stripe/#mandates","text":"read only A Mandate is a record of the permission a customer has given you to debit their payment method. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 create foreign table stripe . mandates ( id text , payment_method text , status text , type text , attrs jsonb ) server stripe_server options ( object 'mandates' ); While any column is allowed in a where clause, it is most efficient to filter by: id","title":"Mandates"},{"location":"stripe/#payment-intents","text":"read only A payment intent guides you through the process of collecting a payment from your customer. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . payment_intents ( id text , customer text , amount bigint , currency text , payment_method text , created timestamp , attrs jsonb ) server stripe_server options ( object 'payment_intents' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer","title":"Payment Intents"},{"location":"stripe/#payouts","text":"read only A Payout object is created when you receive funds from Stripe, or when you initiate a payout to either a bank account or debit card of a connected Stripe account. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . payouts ( id text , amount bigint , currency text , arrival_date timestamp , description text , statement_descriptor text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'payouts' ); While any column is allowed in a where clause, it is most efficient to filter by: id status","title":"Payouts"},{"location":"stripe/#products","text":"read and modify All products available in Stripe. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . products ( id text , name text , active bool , default_price text , description text , created timestamp , updated timestamp , attrs jsonb ) server stripe_server options ( object 'products' , rowid_column 'id' ); While any column is allowed in a where clause, it is most efficient to filter by: id active","title":"Products"},{"location":"stripe/#refunds","text":"read only Refund objects allow you to refund a charge that has previously been created but not yet refunded. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . refunds ( id text , amount bigint , currency text , charge text , payment_intent text , reason text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'refunds' ); While any column is allowed in a where clause, it is most efficient to filter by: id charge payment_intent","title":"Refunds"},{"location":"stripe/#setupattempts","text":"read only A SetupAttempt describes one attempted confirmation of a SetupIntent, whether that confirmation was successful or unsuccessful. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 create foreign table stripe . setup_attempts ( id text , application text , customer text , on_behalf_of text , payment_method text , setup_intent text , status text , usage text , created timestamp , attrs jsonb ) server stripe_server options ( object 'setup_attempts' ); While any column is allowed in a where clause, it is most efficient to filter by: id setup_intent","title":"SetupAttempts"},{"location":"stripe/#setupintents","text":"read only A SetupIntent guides you through the process of setting up and saving a customer's payment credentials for future payments. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create foreign table stripe . setup_intents ( id text , client_secret text , customer text , description text , payment_method text , status text , usage text , created timestamp , attrs jsonb ) server stripe_server options ( object 'setup_intents' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer payment_method","title":"SetupIntents"},{"location":"stripe/#subscriptions","text":"read and modify Customer recurring payment schedules. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . subscriptions ( id text , customer text , currency text , current_period_start timestamp , current_period_end timestamp , attrs jsonb ) server stripe_server options ( object 'subscriptions' , rowid_column 'id' ); While any column is allowed in a where clause, it is most efficient to filter by: id customer price status","title":"Subscriptions"},{"location":"stripe/#tokens","text":"read only Tokenization is the process Stripe uses to collect sensitive card or bank account details, or personally identifiable information (PII), directly from your customers in a secure manner. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 create foreign table stripe . tokens ( id text , customer text , currency text , current_period_start timestamp , current_period_end timestamp , attrs jsonb ) server stripe_server options ( object 'tokens' );","title":"Tokens"},{"location":"stripe/#top-ups","text":"read only To top up your Stripe balance, you create a top-up object. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . topups ( id text , amount bigint , currency text , description text , status text , created timestamp , attrs jsonb ) server stripe_server options ( object 'topups' ); While any column is allowed in a where clause, it is most efficient to filter by: id status","title":"Top-ups"},{"location":"stripe/#transfers","text":"read only A Transfer object is created when you move funds between Stripe accounts as part of Connect. Ref: Stripe docs 1 2 3 4 5 6 7 8 9 10 11 12 13 create foreign table stripe . transfers ( id text , amount bigint , currency text , description text , destination text , created timestamp , attrs jsonb ) server stripe_server options ( object 'transfers' ); While any column is allowed in a where clause, it is most efficient to filter by: id destination","title":"Transfers"},{"location":"stripe/#examples","text":"Some examples on how to use Stripe foreign tables.","title":"Examples"},{"location":"stripe/#simple-query","text":"1 2 3 4 -- always limit records to reduce API calls to Stripe select * from stripe . customers limit 10 ; select * from stripe . invoices limit 10 ; select * from stripe . subscriptions limit 10 ;","title":"Simple Query"},{"location":"stripe/#query-json-attributes","text":"attrs is a common column which stores all the object attributes in JSON format, you can extract any attributes needed or its associated sub objects from it. For example, 1 2 3 4 5 6 7 8 9 10 11 -- extract account name for an invoice select id , attrs ->> 'account_name' as account_name from stripe . invoices where id = 'in_xxx' ; -- extract invoice line items for an invoice select id , attrs #> '{lines,data}' as line_items from stripe . invoices where id = 'in_xxx' ; -- extract subscription items for a subscription select id , attrs #> '{items,data}' as items from stripe . subscriptions where id = 'sub_xxx' ;","title":"Query JSON Attributes"},{"location":"stripe/#data-modify","text":"1 2 3 4 insert into stripe . customers ( email , name , description ) values ( 'test@test.com' , 'test name' , null ); update stripe . customers set description = 'hello fdw' where id = 'cus_xxx' ; update stripe . customers set attrs = '{\"metadata[foo]\": \"bar\"}' where id = 'cus_xxx' ; delete from stripe . customers where id = 'cus_xxx' ;","title":"Data Modify"},{"location":"usage/","text":"supabase/wrappers leverages PostgreSQL's builtin foreign data wrapper (FDW) functionality to integrate with third-party services. To enable an integration, we first must enable the extension 1 create extension wrappers Firebase Firebase is an app development platform built around non-relational technologies. The Firebase wrapper supports connecting to the auth/users collection and any Firestore collection . Wrapper To get started with the Firebase wrapper, create a foreign data wrapper specifying FirebaseFdw as the wrapper key of the options section. 1 2 3 4 5 6 create foreign data wrapper firebase_wrapper handler wrappers_handler validator wrappers_validator options ( wrapper 'FirebaseFdw' ); Server Next, we need to create a server for the FDW to hold options and credentials. Auth (Supabase) If you are using the Supabase platform, this is the recommended approach for securing your Firebase service account credentials. Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'firebase' ); Save your Firebase service account key in Vault and retrieve the key_id 1 2 3 4 5 6 7 8 9 10 11 12 13 insert into vault . secrets ( secret , key_id ) values ( '{ \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... }' , ( select id from pgsodium . valid_key where name = 'firebase' ) ); returning key_id ; Create the foreign server 1 2 3 4 5 6 create server firebase_server foreign data wrapper firebase_wrapper options ( sa_key_id '<your key_id from above>' project_id '<firebase_project_id>' ); Auth (Insecure) If the platform you are using does not support pgsodium and Vault , you can create a server by storing your service account key directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 6 7 8 9 10 11 12 create server firebase_server foreign data wrapper firebase_wrapper options ( sa_key ' { \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... } ' , project_id 'firebase_project_id' , ); Tables Firebase collections are non-relational/documents. With the exception of metadata fields, all returned data are available as a fields jsonb column. Firestore To map a Firestore collection provide its location using the format firestore/<collection_id> as the object option as shown below. 1 2 3 4 5 6 7 8 9 10 create foreign table firebase_docs ( name text , fields jsonb , create_time timestamp , update_time timestamp ) server my_firebase_server options ( object 'firestore/user-profiles' -- format: 'firestore/[collection_id]' ); Note that name , create_time , and update_time , are automatic metadata fields on all Firestore collections. auth/users The auth/users collection is a special case with unique metadata. The following shows how to map Firebase users to PostgreSQL table. 1 2 3 4 5 6 7 8 9 create foreign table firebase_users ( uid text , email text , fields jsonb ) server my_firebase_server options ( object 'auth/users' ); Stripe Stripe is an API driven online payment processing utility. supabase/wrappers exposes the balance , customers , and subscriptions , endpoints. Wrapper To get started with the Stripe wrapper, create a foreign data wrapper specifying the StripeFdw as the wrapper key of the options section. 1 2 3 4 5 6 create foreign data wrapper stripe_wrapper handler wrappers_handler validator wrappers_validator options ( wrapper 'StripeFdw' ); Server Next, we need to create a server for the FDW to hold options and credentials. Auth (Supabase) If you are using the Supabase platform, this is the recommended approach for securing your Stripe API key . Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'stripe' ); Save your Stripe API key in Vault and retrieve the key_id 1 2 3 4 5 6 7 insert into vault . secrets ( secret , key_id ) values ( 'sk_test_xxx' , ( select id from pgsodium . valid_key where name = 'stripe' ) ) returning key_id ; Create the foreign server 1 2 3 4 5 create server stripe_server foreign data wrapper stripe_wrapper options ( api_key_id '<your key_id from above>' ); Auth (Insecure) If the platform you are using does not support pgsodium and Vault you can create a server by storing your Stripe API key directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 create server stripe_server foreign data wrapper stripe_wrapper options ( api_key 'sk_test_xxx' ); Tables The Stripe tables mirror Stripe's API. Available tables represent balance , customers , and subscriptions . (Optional) Create a schema to hold the Stripe tables. 1 create schema stripe ; Balance Shows the balance currently on your Stripe account. 1 2 3 4 5 6 7 8 create foreign table stripe . balance ( amount bigint , currency text ) server stripe_server options ( object 'balance' ); Customers Contains customers known to Stripe. 1 2 3 4 5 6 7 8 create foreign table stripe . customers ( id text , email text ) server my_stripe_server options ( object 'customers' ); Subscriptions Customer recurring payment schedules. 1 2 3 4 5 6 7 8 9 10 create foreign table stripe . subscriptions ( customer_id text , currency text , current_period_start bigint , current_period_end bigint ) server my_stripe_server options ( object 'subscriptions' );","title":"Usage"},{"location":"usage/#firebase","text":"Firebase is an app development platform built around non-relational technologies. The Firebase wrapper supports connecting to the auth/users collection and any Firestore collection .","title":"Firebase"},{"location":"usage/#wrapper","text":"To get started with the Firebase wrapper, create a foreign data wrapper specifying FirebaseFdw as the wrapper key of the options section. 1 2 3 4 5 6 create foreign data wrapper firebase_wrapper handler wrappers_handler validator wrappers_validator options ( wrapper 'FirebaseFdw' );","title":"Wrapper"},{"location":"usage/#server","text":"Next, we need to create a server for the FDW to hold options and credentials.","title":"Server"},{"location":"usage/#auth-supabase","text":"If you are using the Supabase platform, this is the recommended approach for securing your Firebase service account credentials. Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'firebase' ); Save your Firebase service account key in Vault and retrieve the key_id 1 2 3 4 5 6 7 8 9 10 11 12 13 insert into vault . secrets ( secret , key_id ) values ( '{ \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... }' , ( select id from pgsodium . valid_key where name = 'firebase' ) ); returning key_id ; Create the foreign server 1 2 3 4 5 6 create server firebase_server foreign data wrapper firebase_wrapper options ( sa_key_id '<your key_id from above>' project_id '<firebase_project_id>' );","title":"Auth (Supabase)"},{"location":"usage/#auth-insecure","text":"If the platform you are using does not support pgsodium and Vault , you can create a server by storing your service account key directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 6 7 8 9 10 11 12 create server firebase_server foreign data wrapper firebase_wrapper options ( sa_key ' { \"type\": \"service_account\", \"project_id\": \"your_gcp_project_id\", ... } ' , project_id 'firebase_project_id' , );","title":"Auth (Insecure)"},{"location":"usage/#tables","text":"Firebase collections are non-relational/documents. With the exception of metadata fields, all returned data are available as a fields jsonb column.","title":"Tables"},{"location":"usage/#firestore","text":"To map a Firestore collection provide its location using the format firestore/<collection_id> as the object option as shown below. 1 2 3 4 5 6 7 8 9 10 create foreign table firebase_docs ( name text , fields jsonb , create_time timestamp , update_time timestamp ) server my_firebase_server options ( object 'firestore/user-profiles' -- format: 'firestore/[collection_id]' ); Note that name , create_time , and update_time , are automatic metadata fields on all Firestore collections.","title":"Firestore"},{"location":"usage/#authusers","text":"The auth/users collection is a special case with unique metadata. The following shows how to map Firebase users to PostgreSQL table. 1 2 3 4 5 6 7 8 9 create foreign table firebase_users ( uid text , email text , fields jsonb ) server my_firebase_server options ( object 'auth/users' );","title":"auth/users"},{"location":"usage/#stripe","text":"Stripe is an API driven online payment processing utility. supabase/wrappers exposes the balance , customers , and subscriptions , endpoints.","title":"Stripe"},{"location":"usage/#wrapper_1","text":"To get started with the Stripe wrapper, create a foreign data wrapper specifying the StripeFdw as the wrapper key of the options section. 1 2 3 4 5 6 create foreign data wrapper stripe_wrapper handler wrappers_handler validator wrappers_validator options ( wrapper 'StripeFdw' );","title":"Wrapper"},{"location":"usage/#server_1","text":"Next, we need to create a server for the FDW to hold options and credentials.","title":"Server"},{"location":"usage/#auth-supabase_1","text":"If you are using the Supabase platform, this is the recommended approach for securing your Stripe API key . Create a secure key using pgsodium 1 select pgsodium . create_key ( name : = 'stripe' ); Save your Stripe API key in Vault and retrieve the key_id 1 2 3 4 5 6 7 insert into vault . secrets ( secret , key_id ) values ( 'sk_test_xxx' , ( select id from pgsodium . valid_key where name = 'stripe' ) ) returning key_id ; Create the foreign server 1 2 3 4 5 create server stripe_server foreign data wrapper stripe_wrapper options ( api_key_id '<your key_id from above>' );","title":"Auth (Supabase)"},{"location":"usage/#auth-insecure_1","text":"If the platform you are using does not support pgsodium and Vault you can create a server by storing your Stripe API key directly. Important Credentials stored using this method can be viewed as plain text by anyone with access to pg_catalog.pg_foreign_server 1 2 3 4 5 create server stripe_server foreign data wrapper stripe_wrapper options ( api_key 'sk_test_xxx' );","title":"Auth (Insecure)"},{"location":"usage/#tables_1","text":"The Stripe tables mirror Stripe's API. Available tables represent balance , customers , and subscriptions . (Optional) Create a schema to hold the Stripe tables. 1 create schema stripe ;","title":"Tables"},{"location":"usage/#balance","text":"Shows the balance currently on your Stripe account. 1 2 3 4 5 6 7 8 create foreign table stripe . balance ( amount bigint , currency text ) server stripe_server options ( object 'balance' );","title":"Balance"},{"location":"usage/#customers","text":"Contains customers known to Stripe. 1 2 3 4 5 6 7 8 create foreign table stripe . customers ( id text , email text ) server my_stripe_server options ( object 'customers' );","title":"Customers"},{"location":"usage/#subscriptions","text":"Customer recurring payment schedules. 1 2 3 4 5 6 7 8 9 10 create foreign table stripe . subscriptions ( customer_id text , currency text , current_period_start bigint , current_period_end bigint ) server my_stripe_server options ( object 'subscriptions' );","title":"Subscriptions"}]}